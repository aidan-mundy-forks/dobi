<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Tasks &mdash; dobi 0.8 documentation</title>
    
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.8',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="dobi 0.8 documentation" href="index.html" />
    <link rel="prev" title="Config Variables" href="variables.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body role="document">
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="tasks">
<h1>Tasks<a class="headerlink" href="#tasks" title="Permalink to this headline">¶</a></h1>
<p>Each resource defined in the <code class="docutils literal"><span class="pre">dobi.yml</span></code> provides one or more tasks. Each
resource has a default action, which is usually the &#8220;create&#8221; or &#8220;build&#8221; action
associated with that resource (build an image, run a container, etc).</p>
<p>Each resource also defines a <code class="docutils literal"><span class="pre">remove</span></code> task which can be used to remove
anything that was created by the create action of the resource.</p>
<p>To run a task use the name of the resource, and optionally an action name.</p>
<div class="highlight-sh"><div class="highlight"><pre><span></span><span class="c1"># Run the test resource</span>
dobi <span class="nb">test</span>

<span class="c1"># Run the remove action for the builder resource</span>
dobi builder:rm
</pre></div>
</div>
<div class="section" id="built-in-tasks">
<h2>Built-in Tasks<a class="headerlink" href="#built-in-tasks" title="Permalink to this headline">¶</a></h2>
<div class="section" id="list">
<h3>list<a class="headerlink" href="#list" title="Permalink to this headline">¶</a></h3>
<p>List all the configured resources with a description.</p>
<div class="highlight-sh"><div class="highlight"><pre><span></span>dobi list
</pre></div>
</div>
</div>
<div class="section" id="autoclean">
<h3>autoclean<a class="headerlink" href="#autoclean" title="Permalink to this headline">¶</a></h3>
<p>Run the <code class="docutils literal"><span class="pre">:rm</span></code> action for every configured resource.</p>
<div class="highlight-sh"><div class="highlight"><pre><span></span>dobi autoclean
</pre></div>
</div>
</div>
</div>
<div class="section" id="image-tasks">
<h2>Image Tasks<a class="headerlink" href="#image-tasks" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="./config.html#image">image</a> resources have the following tasks:</p>
<div class="section" id="build-default">
<h3><code class="docutils literal"><span class="pre">:build</span></code> <em>(default)</em><a class="headerlink" href="#build-default" title="Permalink to this headline">¶</a></h3>
<p>Build a Docker image from a Dockerfile. The image is tagged using the <strong>image</strong>
field and the first tag from the list of <strong>tags</strong> in the image resource. If the
<strong>tags</strong> field is not set, the value of <code class="docutils literal"><span class="pre">{unique}</span></code> will be used as the time. See
<a class="reference internal" href="variables.html"><span class="doc">Config Variables</span></a> for more information about how to set the unique value.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>For every image built by <strong>dobi</strong> a small file is created in the <code class="docutils literal"><span class="pre">./.dobi/images/</span></code>
directory (relative to the directory which contains the <code class="docutils literal"><span class="pre">dobi.yaml</span></code>). This
file is used to track the modified time of the image. This file is necessary
because Docker does not store the &#8220;last built&#8221; time of an image, only the first
time it was built. If the image is built again, and the build is completely cached,
no new image id gets created, so the &#8220;created time&#8221; of the image is actually the
original created time.</p>
<p>Without this file images often appear as stale, because the original created time
of the image is earlier than the last attempted build. This will happen when a file
in the image context is modified, but that modification doesn&#8217;t change the docker
build cache (which is the case if the modified file is never added to the image
using <code class="docutils literal"><span class="pre">COPY</span></code> or <code class="docutils literal"><span class="pre">ADD</span></code>). By saving the image id in a local file, and using the
modified time of that file as the &#8220;last build time&#8221;, <strong>dobi</strong> is able to skip
the build of an image in many cases.</p>
<p class="last">If Docker adds a &#8220;last modified&#8221; time to the image data, <strong>dobi</strong> will be able
to use that time instead of tracking the time itself.</p>
</div>
</div>
<div class="section" id="pull">
<h3><code class="docutils literal"><span class="pre">:pull</span></code><a class="headerlink" href="#pull" title="Permalink to this headline">¶</a></h3>
<p>Pull the image from a registry based on the <strong>pull</strong> policy. <strong>pull</strong> is the
default action if the image resource does not have a <strong>context</strong> or <strong>dockerfile</strong>
field defined.</p>
</div>
<div class="section" id="tag">
<h3><code class="docutils literal"><span class="pre">:tag</span></code><a class="headerlink" href="#tag" title="Permalink to this headline">¶</a></h3>
<p>Tag the image with all the tags in the <strong>tags</strong> field.</p>
<p>The <code class="docutils literal"><span class="pre">:tag</span></code> action always depends on the <code class="docutils literal"><span class="pre">:build</span></code> action for the image.</p>
</div>
<div class="section" id="push">
<h3><code class="docutils literal"><span class="pre">:push</span></code><a class="headerlink" href="#push" title="Permalink to this headline">¶</a></h3>
<p>Push the image tags to a registry.</p>
<p>The <code class="docutils literal"><span class="pre">:push</span></code> action always depends on the <code class="docutils literal"><span class="pre">:tag</span></code> action for the image.</p>
</div>
<div class="section" id="remove">
<h3><code class="docutils literal"><span class="pre">:remove</span></code><a class="headerlink" href="#remove" title="Permalink to this headline">¶</a></h3>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">alias:</th><td class="field-body"><code class="docutils literal"><span class="pre">:rm</span></code></td>
</tr>
</tbody>
</table>
<p>Remove all the image tags, and the image.</p>
</div>
</div>
<div class="section" id="job-tasks">
<h2>Job Tasks<a class="headerlink" href="#job-tasks" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="./config.html#job">job</a> resources have the following tasks:</p>
<div class="section" id="run-default">
<h3><code class="docutils literal"><span class="pre">:run</span></code> <em>(default)</em><a class="headerlink" href="#run-default" title="Permalink to this headline">¶</a></h3>
<p>Run a process in a container.</p>
</div>
<div class="section" id="id1">
<h3><code class="docutils literal"><span class="pre">:remove</span></code><a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">alias:</th><td class="field-body"><code class="docutils literal"><span class="pre">:rm</span></code></td>
</tr>
</tbody>
</table>
<p>Remove the container (if it exists), and remove the artifact (if one is defined).</p>
<p><code class="docutils literal"><span class="pre">:capture(VARIABLE)</span></code></p>
<p>Capture stdout of the job in an environment variable. The environment variable
will be available to subsequent tasks.</p>
</div>
</div>
<div class="section" id="mount-tasks">
<h2>Mount Tasks<a class="headerlink" href="#mount-tasks" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="./config.html#mount">mount</a> resources have the following tasks:</p>
<div class="section" id="create-default">
<h3><code class="docutils literal"><span class="pre">:create</span></code> <em>(default)</em><a class="headerlink" href="#create-default" title="Permalink to this headline">¶</a></h3>
<p>Create the host directory to be bind mounted, if it doesn&#8217;t already exist.</p>
</div>
<div class="section" id="id2">
<h3><code class="docutils literal"><span class="pre">:remove</span></code><a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">alias:</th><td class="field-body"><code class="docutils literal"><span class="pre">:rm</span></code></td>
</tr>
</tbody>
</table>
<p>Does nothing. This action exists because all resources have have a remove task.</p>
</div>
</div>
<div class="section" id="alias-tasks">
<h2>Alias Tasks<a class="headerlink" href="#alias-tasks" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="./config.html#alias">alias</a> resources have the following tasks:</p>
<div class="section" id="id3">
<h3><code class="docutils literal"><span class="pre">:run</span></code> <em>(default)</em><a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h3>
<p>Run all the tasks in the list of tasks.</p>
</div>
<div class="section" id="id4">
<h3><code class="docutils literal"><span class="pre">:remove</span></code><a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h3>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">alias:</th><td class="field-body"><code class="docutils literal"><span class="pre">:rm</span></code></td>
</tr>
</tbody>
</table>
<p>Remove runs the remove task for all the resources in the task list in
reverse order.</p>
</div>
</div>
<div class="section" id="compose-tasks">
<h2>Compose Tasks<a class="headerlink" href="#compose-tasks" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="./config.html#compose">compose</a> resources have the following tasks:</p>
<div class="section" id="up-default">
<h3><code class="docutils literal"><span class="pre">:up</span></code> <em>(default)</em><a class="headerlink" href="#up-default" title="Permalink to this headline">¶</a></h3>
<p>Up runs <code class="docutils literal"><span class="pre">docker-compose</span> <span class="pre">up</span> <span class="pre">-d</span></code> with the files and project name from
the resource to create a new isolated environment. When the <code class="docutils literal"><span class="pre">dobi</span></code> task
execution is complete the project is stopped with <code class="docutils literal"><span class="pre">docker-compose</span> <span class="pre">stop</span></code>.
To keep the project running use <code class="docutils literal"><span class="pre">:attach</span></code> or <code class="docutils literal"><span class="pre">:detach</span></code>.</p>
</div>
<div class="section" id="down">
<h3><code class="docutils literal"><span class="pre">:down</span></code><a class="headerlink" href="#down" title="Permalink to this headline">¶</a></h3>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">alias:</th><td class="field-body"><code class="docutils literal"><span class="pre">:rm</span></code>, <code class="docutils literal"><span class="pre">:remove</span></code></td>
</tr>
</tbody>
</table>
<p>Down runs <code class="docutils literal"><span class="pre">docker-compose</span> <span class="pre">down</span></code> to remove all the containers and networks created
by Compose.</p>
</div>
<div class="section" id="attach">
<h3><code class="docutils literal"><span class="pre">:attach</span></code><a class="headerlink" href="#attach" title="Permalink to this headline">¶</a></h3>
<p>Attach runs <code class="docutils literal"><span class="pre">docker-compose</span> <span class="pre">up</span></code> and attaches to the logs.</p>
</div>
<div class="section" id="detach">
<h3><code class="docutils literal"><span class="pre">:detach</span></code><a class="headerlink" href="#detach" title="Permalink to this headline">¶</a></h3>
<p>Detach runs <code class="docutils literal"><span class="pre">docker-compose</span> <span class="pre">up</span> <span class="pre">-d</span></code> and the project continues to run when <code class="docutils literal"><span class="pre">dobi</span></code>
exits.</p>
</div>
</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">dobi</a></h1>



<p class="blurb">A build automation tool for Docker applications</p>




<p>
<iframe src="https://ghbtns.com/github-btn.html?user=dnephin&repo=dobi&type=star&count=true&size=large&v=2"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>





<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="install.html">Install</a></li>
<li class="toctree-l1"><a class="reference internal" href="examples.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="config.html">Config Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="variables.html">Config Variables</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Tasks</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#built-in-tasks">Built-in Tasks</a></li>
<li class="toctree-l2"><a class="reference internal" href="#image-tasks">Image Tasks</a></li>
<li class="toctree-l2"><a class="reference internal" href="#job-tasks">Job Tasks</a></li>
<li class="toctree-l2"><a class="reference internal" href="#mount-tasks">Mount Tasks</a></li>
<li class="toctree-l2"><a class="reference internal" href="#alias-tasks">Alias Tasks</a></li>
<li class="toctree-l2"><a class="reference internal" href="#compose-tasks">Compose Tasks</a></li>
</ul>
</li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="variables.html" title="previous chapter">Config Variables</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      
      
      
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.4.5</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="_sources/tasks.txt"
          rel="nofollow">Page source</a>
    </div>

    
    <a href="https://github.com/dnephin/dobi" class="github">
        <img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png" alt="Fork me on GitHub"  class="github"/>
    </a>
    

    
  </body>
</html>